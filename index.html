<html>
<head>
  <title>Hexagram</title>
  <link href="/favicon.ico" rel="icon" type="image/x-icon" />
  <link rel="stylesheet" type="text/css" href="http://necolas.github.io/normalize.css/2.1.2/normalize.css" />
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
  <script src="/js/getTags.js"></script>
  <style type="text/css">
    @font-face {
      font-family: 'PT Sans Narrow';
      font-style: normal;
      font-weight: 400;
      src: local('PT Sans Narrow'), local('PTSans-Narrow'), url(http://themes.googleusercontent.com/static/fonts/ptsansnarrow/v4/UyYrYy3ltEffJV9QueSi4Z4t0mJKPaLVqklzZuc32b4.woff) format('woff');
    }

    body {
      background: url('images/honey_im_subtle_@2X.png');
      margin: 0;
      font-family: 'PT Sans Narrow';
      text-align: center;
      background-color: black;
      color: whitesmoke;
      text-shadow: #684F3F 2px 2px;
    }

    .container {
      height: 100%;
      width: 100%;
      background-color: rgba(0,0,0,0.8);
    }

    h3 {
      padding-top: 1em;
      font-weight: normal;
    }

    input[type=text] {
      font-family: inherit;
      color: whitesmoke;
      background-color: rgba(0,0,0,0.1);
      text-align: center;
      width: 90%;
      border: none;
      font-size: 10em;
      line-height: 1.3;
    }

    input:focus, textarea:focus {
      outline: none;
    }

    .hashtag-container {
      overflow: scroll;
      max-height: 60%;
    }

    .tag {
      display: inline-block;
      margin: 1em;
      font-size: 1.5em;
    }

    a {
      text-decoration: none;
      color: whitesmoke;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="hashtag-form">
      <h3>Enter a hashtag to search for images</h3>
      <form action="/hex" method="get" class="hashtagSelection">
        <input type="text" id="hashtag" name="hashtag" placeholder="#" autocomplete="off" autofocus /><br>
      </form>
    </div>
    <div class="hashtag-container" id="hashtag-container"></div>
  </div>
</body>
</html>

<script>
  var tag;
  var timeout;
  var $hashtag = $('#hashtag');
  var $tagContainer = $('#hashtag-container');

  var getTags = function(hash, callback) {
    $.ajax({
      url: '/api/tags/' + hash,
      success: function(response){
        console.log(response);
        callback.call(self, response.tags);
      },
      error: function(error) {
        console.log(error);
      }
    });
  };

  var renderTags = function(tags) {
    $tagContainer.empty();
    tags.forEach(function(tag) {
      var $p = $('<p class="tag">');
      var $link = $('<a>').attr('href', '/'+tag.name).text('#' + tag.name);
      $link.appendTo($p);
      $p.appendTo($tagContainer);
    });
  }

  var wait300 = function(fn, arg1, arg2) {
    timeout = window.setTimeout(fn, 300, arg1, arg2);
  };

  $hashtag.on('keyup', function() {
    var text = $hashtag.val();
    if (text.length > 1 && text.charAt(0) !== '#') {
      $hashtag.val('#'.concat(text));
    }
    if (text.length > 5) {
      window.clearTimeout(timeout);
      text = text.slice(1);
      wait300(getTags, text, renderTags);
    } else if (text.length === 0) {
      window.clearTimeout(timeout);
      wait300(function() {
        $tagContainer.empty();
      });
    }
  });

</script>