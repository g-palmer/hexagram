<html>
<head>
  <title>HexaGram</title>
  <link href="/favicon.ico" rel="icon" type="image/x-icon" />
  <link rel="stylesheet" type="text/css" href="css/index.css">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
  <script src="/js/getTags.js"></script>
</head>
<body>
  <div class="hashtag-form">
    <p>Enter a hashtag to search for images</p>
    <form action="/hex" method="get" class="hashtagSelection">
      <input type="text" id="hashtag" name="hashtag" placeholder="#" autocomplete="off" autofocus /><br>
    </form>
  </div>
  <div class="hashtag-container" id="hashtag-container"></div>
</body>
</html>

<script>
  var timeout;
  var $hashtag = $('#hashtag');
  var $tagContainer = $('#hashtag-container');

  var getTags = function(hash, callback) {
    $.ajax({
      url: '/api/tags/' + hash,
      success: function(response){
        console.log(response);
        callback.call(self, response.tags);
      },
      error: function(error) {
        console.log(error);
      }
    });
  };

  var renderTags = function(tags) {
    $tagContainer.empty();
    tags.forEach(function(tag) {
      $('<p class="tag">').text('#' + tag.name).appendTo($tagContainer);
    });
  }

  var wait300 = function(fn, arg1, arg2) {
    timeout = window.setTimeout(fn, 300, arg1, arg2);
  };

  $hashtag.on('keyup', function() {
    if ($hashtag.val().length > 4) {
      window.clearTimeout(timeout);
      wait300(getTags, $hashtag.val(), renderTags);
    } else if ($hashtag.val().length === 0) {
      window.clearTimeout(timeout);
      wait300(function() {
        $tagContainer.empty();
      });
    }
  });

</script>